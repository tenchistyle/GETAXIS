<!DOCTYPE html> 
<html>
<head>
<meta charset="utf-8">
<title>Ingreso Getaxis</title>
<link href="jquery-mobile/jquery.mobile-1.0a3.min.css" rel="stylesheet" type="text/css"/>
<script src="jquery-mobile/jquery-1.5.min.js" type="text/javascript"></script>
<script src="jquery-mobile/jquery.mobile-1.0a3.min.js" type="text/javascript"></script>
<script src="/phonegap.js" type="text/javascript"></script>
<script type="text/javascript" src="prototype.js"></script>
<script type="text/javascript">
function leerGET(){ 
  var cadGET = location.search.substr(1,location.search.length); 
  var arrGET = cadGET.split("&"); 
  var asocGET = new Array(); 
  var variable = ""; 
  var valor = ""; 
  for(i=0;i<arrGET.length;i++){ 
    var aux = arrGET[i].split("="); 
    variable = aux[0]; 
    valor = aux[1]; 
    asocGET[variable] = valor; 
  } 
  return asocGET; 
} 
var paresVarValor = leerGET();
var taxista= paresVarValor["taxista"];
var pasajero= paresVarValor["pasajero"];
</script>
<script type="text/javascript">
var Comet = Class.create();
Comet.prototype = {
        timestamp: 0,
        url: 'http://201.239.164.111/Getaxis/Taxista/AceptePasajero.php?taxista='+taxista+'&pasajero='+pasajero+'&msg=AceptadoPasajero',
        noerror: true,
        initialize: function(){ },
        connect: function(){
        this.ajax = new Ajax.Request(this.url, {
                method: 'get',
                parameters: { 'timestamp' : this.timestamp },
                onSuccess: function(transport) {
                                // manejamos la respuesta del servidor
                        var response = transport.responseText.evalJSON();
                        this.comet.timestamp = response['timestamp'];
                        this.comet.handleResponse(response);
                        this.comet.noerror = true;
                        },
                onComplete: function(transport) {
                                // enviamos nueva petición ajax cuando esta haya finalizado
                        if (!this.comet.noerror)
                                        // si conexión tuvo problemas, intentar reconectar cada 5 segundos
                                setTimeout(function(){ 
                                                comet.connect() 
                                                }, 5000); 
                        else
                                this.comet.connect();
                                this.comet.noerror = false;
                        }});
                this.ajax.comet = this;
        },
        disconnect: function(){ },
        handleResponse: function(response){
			location.href="Nodisponible.html?taxista="+taxista+"&pasajero="+pasajero;
			;},
        doRequest: function(){
               new Ajax.Request(this.url, {
                method: 'get',
                parameters: { 'msg' : 'AceptadoPasajero' }
        })
		
        }
}
var comet = new Comet();
comet.connect();
</script>

</head> 
<body  onLoad="comet.doRequest( ); return false;"> 

<div data-role="page" id="page">
	<div data-role="header">
		<h1>Getaxis</h1>
	</div>
    <div data-role="content">
    <h1>Esperando Sincronización</h1>
    </div>
	<div data-role="footer">
		<h4>XtreamSoft @ [Taxista V.1.0]</h4>
	</div>
</div>
</body>
</html>
